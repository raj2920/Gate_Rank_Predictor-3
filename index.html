<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GATE CS 2026 Â· Response Sheet Calculator</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a192f 0%, #1a2a3f 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 32px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        h1 {
            color: #ffd700;
            font-size: 2rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h1 span {
            font-size: 1rem;
            background: #2a3f5e;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
        }
        
        .subtitle {
            color: #a0b8d0;
            margin-bottom: 30px;
            border-bottom: 1px solid #2a3f5e;
            padding-bottom: 15px;
        }
        
        .shift-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .shift-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: #1e2e42;
            color: #8a9fb0;
        }
        
        .shift-btn.active {
            background: #ffd700;
            color: #0a192f;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }
        
        .upload-area {
            background: #1a2a3f;
            border: 2px dashed #3e5a77;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            margin-bottom: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            border-color: #ffd700;
            background: #1f3145;
        }
        
        .upload-area i {
            font-size: 3rem;
            color: #ffd700;
            margin-bottom: 15px;
            display: block;
        }
        
        .upload-area p {
            color: #b0c8e0;
            font-size: 1.1rem;
        }
        
        .upload-area small {
            color: #6f8aac;
            display: block;
            margin-top: 10px;
        }
        
        .file-info {
            background: #1e2e42;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            color: #ffd700;
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .file-info.show {
            display: flex;
        }
        
        .results {
            background: #122433;
            border-radius: 16px;
            padding: 25px;
            border-left: 6px solid #ffd700;
            margin-top: 25px;
        }
        
        .marks-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .mark-card {
            background: #1a2a3f;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .mark-card .label {
            color: #8a9fb0;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .mark-card .value {
            color: #ffd700;
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        .mark-card .small {
            color: #6f8aac;
            font-size: 0.8rem;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            border-top: 1px solid #2a3f5e;
            border-bottom: 1px solid #2a3f5e;
            margin-bottom: 15px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-item .number {
            font-size: 1.5rem;
            font-weight: 600;
            color: #ffd700;
        }
        
        .stat-item .label {
            color: #8a9fb0;
            font-size: 0.9rem;
        }
        
        .normalization-info {
            background: #1e2e42;
            padding: 15px;
            border-radius: 10px;
            color: #b0c8e0;
            font-size: 0.95rem;
        }
        
        .normalization-info strong {
            color: #ffd700;
        }
        
        .btn {
            background: #ffd700;
            color: #0a192f;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 20px;
        }
        
        .btn:hover {
            background: #ffed4a;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.2);
        }
        
        .btn:disabled {
            background: #4a5a70;
            color: #8a9fb0;
            cursor: not-allowed;
            transform: none;
        }
        
        .error-msg {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #ff6b6b;
        }
        
        .sample-data {
            margin-top: 20px;
            text-align: center;
        }
        
        .sample-btn {
            background: transparent;
            border: 1px solid #ffd700;
            color: #ffd700;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .sample-btn:hover {
            background: rgba(255, 215, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            GATE CS 2026 Rank Predictor
            <span>Official Keys</span>
        </h1>
        <div class="subtitle">
            Upload your response sheet (CSV format) from GOAPS portal Â· Negative marking: 0.33/0.66
        </div>
        
        <!-- Shift Selection -->
        <div class="shift-selector">
            <button class="shift-btn active" data-shift="1">Shift 1 (Set 1)</button>
            <button class="shift-btn" data-shift="2">Shift 2 (Set 2)</button>
        </div>
        
        <!-- File Upload Area -->
        <div class="upload-area" id="uploadArea">
            <i>ðŸ“„</i>
            <p>Click to upload your GATE response sheet (CSV)</p>
            <small>Supports: CSV files exported from GOAPS portal</small>
            <input type="file" id="fileInput" accept=".csv" style="display: none;">
        </div>
        
        <!-- File Info -->
        <div class="file-info" id="fileInfo">
            <span>ðŸ“Ž</span>
            <span id="fileName"></span>
        </div>
        
        <!-- Results Section -->
        <div class="results" id="results" style="display: none;">
            <div class="marks-grid">
                <div class="mark-card">
                    <div class="label">Raw Marks</div>
                    <div class="value" id="rawMarks">0.00</div>
                    <div class="small">before normalization</div>
                </div>
                <div class="mark-card">
                    <div class="label">Normalized</div>
                    <div class="value" id="normMarks">0.00</div>
                    <div class="small" id="normShift">Shift 1: +3</div>
                </div>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="number" id="correctCount">0</div>
                    <div class="label">Correct</div>
                </div>
                <div class="stat-item">
                    <div class="number" id="wrongCount">0</div>
                    <div class="label">Wrong</div>
                </div>
                <div class="stat-item">
                    <div class="number" id="skippedCount">0</div>
                    <div class="label">Skipped</div>
                </div>
            </div>
            
            <div class="normalization-info">
                <strong>ðŸ“Š Normalization applied:</strong> 
                <span id="normDetail">Shift 1: +3 marks added to raw score</span><br>
                <small>1-mark wrong: -0.33 | 2-mark wrong: -0.66</small>
            </div>
        </div>
        
        <!-- Calculate Button -->
        <button class="btn" id="calculateBtn" disabled>Upload response sheet to calculate</button>
        
        <!-- Sample Data Button -->
        <div class="sample-data">
            <button class="sample-btn" id="sampleBtn">ðŸ“‹ Use sample response data</button>
        </div>
        
        <!-- Error Message -->
        <div id="errorMsg" class="error-msg" style="display: none;"></div>
    </div>

    <script>
        // OFFICIAL ANSWER KEYS FROM YOUR PDFs
        const ANSWER_KEYS = {
            shift1: {
                1: 'B', 2: 'C', 3: 'C', 4: 'D', 5: 'C', 6: 'B', 7: 'D', 8: 'A', 9: 'A', 10: 'C',
                11: 'B', 12: 'A', 13: 'A', 14: 'B', 15: 'D', 16: 'B', 17: 'A', 18: 'D',
                19: ['A','C','D'], 20: ['B','D'], 21: ['A','C'], 22: ['B','C'], 23: ['B','C'], 
                24: ['C'], 25: ['A','B','C'], 26: ['B','D'], 27: ['C'], 28: ['C'], 
                29: ['A','C'], 30: ['C','D'], 31: ['A','B','C'],
                32: { min: 3, max: 3 }, 33: { min: 11, max: 13 }, 34: { min: 9, max: 9 }, 35: { min: 6, max: 6 },
                36: 'C', 37: 'B', 38: 'A', 39: 'B', 40: 'D', 41: 'A', 42: 'D', 43: 'B', 44: 'B', 45: 'B',
                46: ['A','C','D'], 47: ['A'], 48: ['B','D'], 49: ['A','D'], 50: ['B','D'], 51: ['C'],
                52: ['B','D'], 53: ['A','B','D'], 54: ['B','C'], 55: ['B','C'], 56: ['A','B','C'],
                57: { min: 34, max: 34 }, 58: { min: 4.24, max: 4.26 }, 59: { min: 77.3, max: 77.3 },
                60: { min: 95, max: 95 }, 61: { min: 65536, max: 65536 }, 62: { min: 7, max: 7 },
                63: { min: 4, max: 4 }, 64: { min: 9.5, max: 9.5 }, 65: { min: 6, max: 6 }
            },
            shift2: {
                1: 'A', 2: 'A', 3: 'A', 4: 'A', 5: 'C', 6: 'A', 7: 'A', 8: 'A', 9: 'B', 10: 'C',
                11: 'A', 12: 'A', 13: 'D', 14: 'B', 15: 'C', 16: 'B', 17: 'C', 18: 'C', 19: 'A', 20: 'A',
                21: 'B', 22: 'C', 23: 'B', 24: 'A', 25: ['A','B'], 26: ['A','B','C'], 27: ['A','C'], 
                28: ['B','D'], 29: ['B','C'],
                30: { min: 3, max: 3 }, 31: { min: 24, max: 24 }, 32: { min: 3, max: 3 },
                33: { min: 4094, max: 4094 }, 34: { min: -60.25, max: -60.25 }, 35: { min: 13, max: 13 },
                36: 'C', 37: 'A', 38: 'A', 39: 'A', 40: 'B', 41: 'D', 42: 'D', 43: 'D', 44: 'B', 45: 'A', 46: 'A',
                47: ['C','D'], 48: ['A','C','D'], 49: ['A','C'], 50: ['A','B'], 51: ['A','B','C'], 52: ['A','B'],
                53: { min: 16417, max: 16417 }, 54: { min: 1536, max: 1536 }, 55: { min: 3, max: 3 },
                56: { min: 128, max: 128 }, 57: { min: 2.30, max: 2.40 }, 58: { min: 4, max: 4 },
                59: { min: 6, max: 6 }, 60: { min: 9, max: 9 }, 61: { min: 1, max: 1 },
                62: { min: 48, max: 48 }, 63: { min: 0.5, max: 0.5 }, 64: { min: 40, max: 40 }, 65: { min: 30, max: 30 }
            }
        };

        // DOM Elements
        const shiftBtns = document.querySelectorAll('.shift-btn');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const calculateBtn = document.getElementById('calculateBtn');
        const results = document.getElementById('results');
        const errorMsg = document.getElementById('errorMsg');
        const sampleBtn = document.getElementById('sampleBtn');
        
        // Result elements
        const rawMarksEl = document.getElementById('rawMarks');
        const normMarksEl = document.getElementById('normMarks');
        const correctCountEl = document.getElementById('correctCount');
        const wrongCountEl = document.getElementById('wrongCount');
        const skippedCountEl = document.getElementById('skippedCount');
        const normDetail = document.getElementById('normDetail');
        const normShift = document.getElementById('normShift');
        
        // State
        let currentShift = '1';
        let uploadedFile = null;
        let responseData = null;
        
        // Shift selection
        shiftBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                shiftBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentShift = btn.dataset.shift;
                
                // Update normalization text
                if (currentShift === '1') {
                    normShift.textContent = 'Shift 1: +3';
                    normDetail.textContent = 'Shift 1: +3 marks added to raw score';
                } else {
                    normShift.textContent = 'Shift 2: -3';
                    normDetail.textContent = 'Shift 2: 3 marks deducted from raw score';
                }
                
                // Recalculate if we have data
                if (responseData) {
                    calculateMarks();
                }
            });
        });
        
        // File upload handling
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                uploadedFile = file;
                fileName.textContent = file.name;
                fileInfo.classList.add('show');
                calculateBtn.disabled = false;
                calculateBtn.textContent = 'Calculate Marks';
                errorMsg.style.display = 'none';
                
                // Read file
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        parseCSV(event.target.result);
                    } catch (err) {
                        showError('Error parsing file. Please ensure it\'s a valid CSV.');
                    }
                };
                reader.readAsText(file);
            }
        });
        
        // Parse CSV (simplified - expects question_number, answer, marks format)
        function parseCSV(content) {
            const lines = content.split('\n');
            const data = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line === '' || i === 0) continue; // Skip header if exists
                
                const parts = line.split(',');
                if (parts.length >= 2) {
                    const qno = parseInt(parts[0]);
                    const answer = parts[1].trim();
                    const markValue = parts.length >= 3 ? parseInt(parts[2]) : (qno <= 35 ? 1 : 2);
                    
                    if (!isNaN(qno) && qno >= 1 && qno <= 65) {
                        data.push({
                            qno: qno,
                            answer: answer,
                            markValue: markValue
                        });
                    }
                }
            }
            
            if (data.length === 0) {
                showError('No valid question data found in CSV');
                return;
            }
            
            responseData = data;
            calculateMarks();
        }
        
        // Check if answer matches key
        function isAnswerCorrect(qno, userAnswer, keySet) {
            const key = keySet[qno];
            if (!key) return false;
            
            // Handle different key types
            if (Array.isArray(key)) {
                // MSQ question
                if (!userAnswer || userAnswer === '') return false;
                const userParts = userAnswer.split(';').map(s => s.trim().toUpperCase()).filter(s => s);
                if (userParts.length !== key.length) return false;
                return userParts.every(ans => key.map(k => k.toUpperCase()).includes(ans));
            } 
            else if (typeof key === 'object' && key.min !== undefined) {
                // NAT question with range
                const num = parseFloat(userAnswer);
                if (isNaN(num)) return false;
                return num >= key.min && num <= key.max;
            }
            else {
                // MCQ - direct comparison
                return userAnswer.trim().toUpperCase() === key.toUpperCase();
            }
        }
        
        // Calculate marks
        function calculateMarks() {
            if (!responseData) {
                showError('No response data loaded');
                return;
            }
            
            const keySet = currentShift === '1' ? ANSWER_KEYS.shift1 : ANSWER_KEYS.shift2;
            let correct = 0;
            let wrong = 0;
            let skipped = 0;
            let rawMarks = 0;
            
            responseData.forEach(item => {
                const qno = item.qno;
                const answer = item.answer || '';
                const markValue = item.markValue;
                
                if (answer === '' || answer === '-' || answer === 'NA') {
                    skipped++;
                } else {
                    if (isAnswerCorrect(qno, answer, keySet)) {
                        correct++;
                        rawMarks += markValue;
                    } else {
                        wrong++;
                        rawMarks -= (markValue === 1 ? 0.33 : 0.66);
                    }
                }
            });
            
            // Apply normalization
            const normalizedMarks = currentShift === '1' ? rawMarks + 3 : rawMarks - 3;
            
            // Update display
            rawMarksEl.textContent = rawMarks.toFixed(2);
            normMarksEl.textContent = normalizedMarks.toFixed(2);
            correctCountEl.textContent = correct;
            wrongCountEl.textContent = wrong;
            skippedCountEl.textContent = skipped;
            
            // Show results
            results.style.display = 'block';
            errorMsg.style.display = 'none';
        }
        
        // Show error
        function showError(message) {
            errorMsg.textContent = message;
            errorMsg.style.display = 'block';
            results.style.display = 'none';
        }
        
        // Calculate button click
        calculateBtn.addEventListener('click', () => {
            if (responseData) {
                calculateMarks();
            } else {
                showError('Please upload a response sheet first');
            }
        });
        
        // Sample data button
        sampleBtn.addEventListener('click', () => {
            // Generate sample data
            responseData = [];
            for (let q = 1; q <= 65; q++) {
                const markValue = q <= 35 ? 1 : 2;
                
                // Generate plausible answers (mix of correct/wrong/skip)
                let answer = '';
                if (q % 7 === 0) {
                    answer = ''; // skip
                } else if (q % 5 === 0) {
                    answer = 'A'; // likely wrong for many
                } else {
                    // Try to set correct answer based on shift
                    const keySet = currentShift === '1' ? ANSWER_KEYS.shift1 : ANSWER_KEYS.shift2;
                    const key = keySet[q];
                    
                    if (Array.isArray(key)) {
                        answer = key.join(';');
                    } else if (key && typeof key === 'object' && key.min !== undefined) {
                        answer = key.min.toString();
                    } else if (key) {
                        answer = key.toString();
                    } else {
                        answer = 'A';
                    }
                }
                
                responseData.push({
                    qno: q,
                    answer: answer,
                    markValue: markValue
                });
            }
            
            fileName.textContent = 'sample_response.csv';
            fileInfo.classList.add('show');
            calculateBtn.disabled = false;
            calculateMarks();
        });
        
        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ffd700';
            uploadArea.style.background = '#1f3145';
        });
        
        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#3e5a77';
            uploadArea.style.background = '#1a2a3f';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#3e5a77';
            uploadArea.style.background = '#1a2a3f';
            
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.csv')) {
                fileInput.files = e.dataTransfer.files;
                const event = new Event('change');
                fileInput.dispatchEvent(event);
            } else {
                showError('Please drop a valid CSV file');
            }
        });
    </script>
</body>
</html>
