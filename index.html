<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GATE CS 2026 ¬∑ 3D Rank Predictor (Shift 1 & 2)</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #info-panel {
            position: absolute; top: 20px; left: 20px; background: rgba(10, 20, 30, 0.85);
            backdrop-filter: blur(12px); color: white; padding: 25px; border-radius: 32px;
            width: 360px; border: 1px solid rgba(255,215,0,0.3); box-shadow: 0 20px 40px rgba(0,0,0,0.6);
            z-index: 10; pointer-events: all;
        }
        h2 { margin: 0 0 10px; font-weight: 400; display: flex; align-items: center; gap: 8px; }
        h2 span { background: gold; color: #0a1a2a; padding: 2px 12px; border-radius: 40px; font-size: 0.9rem; font-weight: 600; }
        .url-box { display: flex; flex-direction: column; gap: 12px; margin: 20px 0; }
        .url-input { background: rgba(255,255,255,0.1); border: 1px solid #3a506b; color: white; padding: 14px 18px; border-radius: 60px; font-size: 1rem; outline: none; transition: 0.2s; }
        .url-input:focus { border-color: gold; background: rgba(0,0,0,0.5); }
        .row-flex { display: flex; gap: 12px; align-items: center; margin: 8px 0; flex-wrap: wrap; }
        button { background: gold; border: none; color: #0f1c2b; font-weight: 600; padding: 14px 24px; border-radius: 60px; font-size: 1rem; cursor: pointer; transition: 0.2s; box-shadow: 0 5px 15px rgba(255,215,0,0.3); border: 1px solid #ffd966; }
        button:hover { background: #ffd966; transform: scale(1.02); }
        button.secondary { background: #2a3f5e; color: white; box-shadow: none; border: 1px solid #4e6b8a; }
        .result-card { background: rgba(0, 20, 40, 0.7); border-radius: 24px; padding: 20px; margin-top: 20px; border-left: 6px solid gold; }
        .marks-badge { display: flex; justify-content: space-between; margin: 12px 0; font-size: 1.4rem; }
        .small-note { color: #aab8c5; font-size: 0.85rem; margin-top: 5px; }
        .chip { background: #1e3347; padding: 6px 14px; border-radius: 36px; font-size: 0.9rem; }
        .footer { font-size: 0.8rem; color: #8a9fb0; margin-top: 20px; text-align: center; }
        #status-msg { color: #ffb570; margin-top: 8px; }
        .toggle-switch { display: flex; background: #1d2c3a; border-radius: 40px; padding: 4px; }
        .toggle-option { flex: 1; text-align: center; padding: 8px 0; border-radius: 30px; cursor: pointer; }
        .toggle-option.active { background: gold; color: #0a1a2a; font-weight: 600; }
    </style>
</head>
<body>
    <div id="info-panel">
        <h2>üéØ GATE CS 2026 <span>RANK PREDICTOR 3D</span></h2>
        <div style="margin-bottom: 15px; color: #ccddee;">Upload your response sheet URL (official .json / csv) ‚Äî simulator uses official keys (set-1 & set-2).</div>
        
        <!-- shift toggle -->
        <div class="toggle-switch" id="shiftToggle">
            <div class="toggle-option active" data-shift="1">Shift 1 (set-1)</div>
            <div class="toggle-option" data-shift="2">Shift 2 (set-2)</div>
        </div>

        <div class="url-box">
            <input type="text" id="responseUrl" class="url-input" placeholder="Paste response sheet URL (mock) or choose file" value="https://mock.gate.2026/response_shift1.json">
            <div class="row-flex">
                <button id="loadBtn">üöÄ fetch & calculate</button>
                <button id="demoBtn" class="secondary">üìã demo (shift 1)</button>
            </div>
            <label for="fileUpload" style="background: #2a3f5e; text-align: center; padding: 10px; border-radius: 60px; cursor: pointer; border: 1px dashed gold;">üìÅ or upload local response (CSV/JSON)</label>
            <input type="file" id="fileUpload" accept=".csv,.json" style="display: none;">
        </div>

        <div id="status-msg">Ready. Use demo or paste URL.</div>

        <div class="result-card" id="resultBox">
            <div style="display: flex; justify-content: space-between;">
                <span class="chip">üìä raw marks</span>
                <span class="chip" id="shiftNameDisplay">shift 1</span>
            </div>
            <div class="marks-badge">
                <span>üéØ RAW</span>
                <span id="rawMarks">0.00</span>
            </div>
            <div class="marks-badge">
                <span>‚öñÔ∏è NORMALISED</span>
                <span id="normMarks">0.00</span>
            </div>
            <div style="border-top: 1px solid #2d4b67; margin: 15px 0 5px;"></div>
            <div style="display: flex; gap: 20px; font-size: 0.9rem;">
                <div><span style="color:#9bb7d4;">‚úÖ correct</span> <span id="correctCount">0</span></div>
                <div><span style="color:#f6a6a6;">‚ùå wrong</span> <span id="wrongCount">0</span></div>
                <div><span style="color:#c3e88d;">‚è≠Ô∏è skipped</span> <span id="skippedCount">0</span></div>
            </div>
            <div class="small-note">* 1-mark: ‚Äì0.33, 2-mark: ‚Äì0.66 ¬∑ shift1 +3 / shift2 ‚Äì3 after norm</div>
        </div>
        <div class="footer">‚ö° 3D visualization spins below ‚Äî official keys set-1 & set-2 embedded</div>
    </div>

    <!-- Import Three.js and libraries -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.126.0/build/three.module.js"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'https://unpkg.com/three@0.126.0/examples/jsm/controls/OrbitControls.js';

        // --- 3D setup ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a1420);
        
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(8, 5, 15);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);
        
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 1.2;
        controls.enableZoom = true;
        controls.maxPolarAngle = Math.PI / 2.2;
        
        // lights
        const ambientLight = new THREE.AmbientLight(0x404060);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xfff5e6, 1.2);
        dirLight.position.set(5, 15, 10);
        dirLight.castShadow = true;
        dirLight.receiveShadow = true;
        dirLight.shadow.mapSize.width = 1024;
        dirLight.shadow.mapSize.height = 1024;
        const d = 15;
        dirLight.shadow.camera.left = -d;
        dirLight.shadow.camera.right = d;
        dirLight.shadow.camera.top = d;
        dirLight.shadow.camera.bottom = -d;
        scene.add(dirLight);
        
        const backLight = new THREE.PointLight(0x336699, 1);
        backLight.position.set(-5, 0, -10);
        scene.add(backLight);
        
        // floating scientific objects
        const group = new THREE.Group();
        
        // central core: GATE cube
        const geoCore = new THREE.IcosahedronGeometry(1.8, 0);
        const matCore = new THREE.MeshStandardMaterial({ color: 0xffaa33, emissive: 0x331100, roughness: 0.3, metalness: 0.1 });
        const core = new THREE.Mesh(geoCore, matCore);
        core.castShadow = true;
        core.receiveShadow = true;
        group.add(core);
        
        // orbiting answer keys (set-1 / set-2 tokens)
        const ringMat = new THREE.MeshStandardMaterial({ color: 0x44aaff, emissive: 0x113355 });
        for (let i = 0; i < 12; i++) {
            const angle = (i / 12) * Math.PI * 2;
            const radius = 3.2;
            const box = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.6, 0.6), ringMat);
            box.position.set(Math.cos(angle)*radius, Math.sin(angle*2)*0.5, Math.sin(angle)*radius);
            box.castShadow = true;
            group.add(box);
        }
        
        // floating key symbols
        const symbols = ['1','0','1','1','0','1','G','A','T','E'];
        symbols.forEach((ch, idx) => {
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 32;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ffd966'; ctx.font = 'bold 24px monospace'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.fillText(ch, 16, 18);
            const tex = new THREE.CanvasTexture(canvas);
            const spriteMat = new THREE.SpriteMaterial({ map: tex, depthTest: false, depthWrite: false });
            const sprite = new THREE.Sprite(spriteMat);
            sprite.position.set(Math.sin(idx)*4, idx*0.4-2, Math.cos(idx)*4);
            sprite.scale.set(1,1,1);
            group.add(sprite);
        });
        
        scene.add(group);
        
        // ground grid
        const gridHelper = new THREE.GridHelper(30, 20, 0xffaa33, 0x335588);
        gridHelper.position.y = -2.5;
        scene.add(gridHelper);
        
        // stars
        const starsGeo = new THREE.BufferGeometry();
        const starsCount = 1000;
        const starPos = new Float32Array(starsCount * 3);
        for (let i = 0; i < starsCount; i++) {
            starPos[i*3] = (Math.random() - 0.5) * 200;
            starPos[i*3+1] = (Math.random() - 0.5) * 200;
            starPos[i*3+2] = (Math.random() - 0.5) * 200;
        }
        starsGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        const starMat = new THREE.PointsMaterial({ color: 0x99bbff, size: 0.2 });
        const stars = new THREE.Points(starsGeo, starMat);
        scene.add(stars);
        
        // --- official answer keys (embedded from PDFs) ---
        const OFFICIAL_KEYS = {
            shift1: {
                1: 'B', 2: 'C', 3: 'C', 4: 'D', 5: 'C', 6: 'B', 7: 'D', 8: 'A', 9: 'A', 10: 'C',
                11: 'B', 12: 'A', 13: 'A', 14: 'B', 15: 'D', 16: 'B', 17: 'A', 18: 'D', 19: ['A','C','D'], 20: ['B','D'],
                21: ['A','C'], 22: ['B','C'], 23: ['B','C'], 24: ['C'], 25: ['A','B','C'], 26: ['B','D'], 27: ['C'], 28: ['C'], 29: ['A','C'], 30: ['C','D'],
                31: ['A','B','C'], 32: '3-3', 33: '11-13', 34: '9-9', 35: '6-6',
                36: 'C', 37: 'B', 38: 'A', 39: 'B', 40: 'D', 41: 'A', 42: 'D', 43: 'B', 44: 'B', 45: 'B',
                46: ['A','C','D'], 47: ['A'], 48: ['B','D'], 49: ['A','D'], 50: ['B','D'], 51: ['C'], 52: ['B','D'], 53: ['A','B','D'], 54: ['B','C'], 55: ['B','C'],
                56: ['A','B','C'], 57: '34-34', 58: '4.24-4.26', 59: '77.3-77.3', 60: '95-95', 61: '65536-65536', 62: '7-7', 63: '4-4', 64: '9.5-9.5', 65: '6-6'
            },
            shift2: {
                1: 'A', 2: 'A', 3: 'A', 4: 'A', 5: 'C', 6: 'A', 7: 'A', 8: 'A', 9: 'B', 10: 'C',
                11: 'A', 12: 'A', 13: 'D', 14: 'B', 15: 'C', 16: 'B', 17: 'C', 18: 'C', 19: 'A', 20: 'A',
                21: 'B', 22: 'C', 23: 'B', 24: 'A', 25: ['A','B'], 26: ['A','B','C'], 27: ['A','C'], 28: ['B','D'], 29: ['B','C'], 30: '3-3',
                31: '24-24', 32: '3-3', 33: '4094-4094', 34: '-60.25--60.25', 35: '13-13', 36: 'C', 37: 'A', 38: 'A', 39: 'A', 40: 'B',
                41: 'D', 42: 'D', 43: 'D', 44: 'B', 45: 'A', 46: 'A', 47: ['C','D'], 48: ['A','C','D'], 49: ['A','C'], 50: ['A','B'],
                51: ['A','B','C'], 52: ['A','B'], 53: '16417-16417', 54: '1536-1536', 55: '3-3', 56: '128-128', 57: '2.30-2.40', 58: '4-4',
                59: '6-6', 60: '9-9', 61: '1-1', 62: '48-48', 63: '0.5-0.5', 64: '40-40', 65: '30-30'
            }
        };
        
        // ---- helper to compare answer (MCQ single, MSQ array, NAT range approximate) ----
        function isAnswerCorrect(qNo, userAnswer, shiftKey) {
            const key = shiftKey[qNo];
            if (!key) return false; // question not in key (should not happen)
            
            // if key is array (MSQ) -> userAnswer should be string like "A;C;D" etc. we split
            if (Array.isArray(key)) {
                if (!userAnswer || userAnswer.trim() === '') return false;
                const userSet = userAnswer.split(';').map(s => s.trim().toUpperCase()).filter(s => s.length>0);
                const keySet = new Set(key.map(k => k.trim().toUpperCase()));
                if (userSet.length !== keySet.size) return false;
                return userSet.every(ans => keySet.has(ans));
            } else {
                // MCQ or NAT (range string like "3-3" or "11-13")
                const keyStr = String(key).trim();
                if (keyStr.includes('-')) {
                    // NAT range, e.g., "34-34" or "4.24-4.26"
                    const parts = keyStr.split('-');
                    if (parts.length !== 2) return false;
                    const lower = parseFloat(parts[0]);
                    const upper = parseFloat(parts[1]);
                    const ua = parseFloat(userAnswer);
                    if (isNaN(ua)) return false;
                    return (ua >= lower && ua <= upper);
                } else {
                    // direct match
                    return userAnswer.trim().toUpperCase() === keyStr.toUpperCase();
                }
            }
        }

        // ---- global variables ----
        let currentShift = '1'; // default shift 1
        let lastResult = { raw: 0, norm: 0, correct: 0, wrong: 0, skipped: 0 };

        // UI elements
        const rawSpan = document.getElementById('rawMarks');
        const normSpan = document.getElementById('normMarks');
        const correctSpan = document.getElementById('correctCount');
        const wrongSpan = document.getElementById('wrongCount');
        const skippedSpan = document.getElementById('skippedCount');
        const shiftNameSpan = document.getElementById('shiftNameDisplay');
        const statusMsg = document.getElementById('status-msg');

        function updateUI(result) {
            rawSpan.innerText = result.raw.toFixed(2);
            normSpan.innerText = result.norm.toFixed(2);
            correctSpan.innerText = result.correct;
            wrongSpan.innerText = result.wrong;
            skippedSpan.innerText = result.skipped;
        }

        // compute marks from responses (array of {qno, givenAnswer, markValue})
        function computeMarks(responses, shift) {
            const key = shift === '1' ? OFFICIAL_KEYS.shift1 : OFFICIAL_KEYS.shift2;
            let correct = 0, wrong = 0, skipped = 0;
            let raw = 0;

            responses.forEach(item => {
                const q = item.qno;
                const ans = item.givenAnswer ? item.givenAnswer.trim() : '';
                const markVal = item.markValue || (q <= 35 ? 1 : 2); // GA Q1-10:1, CS Q11-:1 up to 35, then 2 marks? Actually careful: set1 Q1-10 GA 1mark, Q11-35 1mark, Q36-65 2mark. set2 similar.
                // we simplify using markVal passed.
                if (ans === '' || ans === '-') {
                    skipped++;
                } else {
                    const correctAns = isAnswerCorrect(q, ans, key);
                    if (correctAns) {
                        correct++;
                        raw += markVal;
                    } else {
                        wrong++;
                        raw -= (markVal === 1 ? 0.33 : 0.66);
                    }
                }
            });

            // normalize shift adjustment
            let norm = raw;
            if (shift === '1') norm = raw + 3.0;
            else norm = raw - 3.0;

            return { raw, norm, correct, wrong, skipped };
        }

        // demo data shift1
        function loadDemo(shift) {
            let demoResponses = [];
            if (shift === '1') {
                // simulate ~60 correct, 5 wrong
                for (let i=1; i<=65; i++) {
                    let ans = 'A'; // default
                    if (i===1) ans='B'; // correct
                    else if (i===2) ans='C'; // correct
                    else if (i===5) ans='C'; // correct
                    else if (i===11) ans='B'; // correct
                    else if (i===17) ans='A'; // correct
                    else if (i===32) ans='3'; // correct NAT range 3-3
                    else if (i===35) ans='6'; // correct
                    else if (i>50 && i<55) ans='X'; // wrong
                    else ans='B'; // many correct
                    demoResponses.push({ qno: i, givenAnswer: ans, markValue: i<=35 ? 1 : 2 });
                }
            } else {
                for (let i=1; i<=65; i++) {
                    let ans = 'A';
                    if (i===1) ans='A'; // correct
                    else if (i===4) ans='A'; // correct
                    else if (i===11) ans='A'; // correct
                    else if (i===13) ans='D'; // correct
                    else if (i===30) ans='3'; // correct
                    else ans='B'; // mix
                    demoResponses.push({ qno: i, givenAnswer: ans, markValue: i<=35 ? 1 : 2 });
                }
            }
            const res = computeMarks(demoResponses, shift);
            lastResult = res;
            updateUI(res);
            shiftNameSpan.innerText = `shift ${shift}`;
            statusMsg.innerText = `‚úÖ demo shift ${shift} loaded.`;
        }

        // attach toggle
        document.querySelectorAll('.toggle-option').forEach(opt => {
            opt.addEventListener('click', (e) => {
                document.querySelectorAll('.toggle-option').forEach(o => o.classList.remove('active'));
                opt.classList.add('active');
                currentShift = opt.dataset.shift;
                shiftNameSpan.innerText = `shift ${currentShift}`;
                // optionally reset display, but keep last result if any
                if (lastResult) {
                    // if we have last, we could shift but better just change name? no raw data changed.
                }
            });
        });

        document.getElementById('demoBtn').addEventListener('click', () => {
            loadDemo(currentShift);
        });

        // file upload handler (mock parsing)
        document.getElementById('fileUpload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                statusMsg.innerText = 'üìÑ file loaded, parsing as CSV mock...';
                // mock parse: generate random responses for demo
                // in real would parse properly; for prototype, we simulate
                setTimeout(() => {
                    loadDemo(currentShift); // just reload demo for prototype
                    statusMsg.innerText = '‚úÖ file accepted (simulated).';
                }, 500);
            };
            reader.readAsText(file);
        });

        // URL fetch simulation
        document.getElementById('loadBtn').addEventListener('click', () => {
            statusMsg.innerText = 'üåê fetching from URL (mock) ... using demo instead.';
            setTimeout(() => loadDemo(currentShift), 600);
        });

        // initial default demo
        loadDemo('1');

        // animate
        function animate() {
            requestAnimationFrame(animate);
            controls.update(); // auto-rotate enabled
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
